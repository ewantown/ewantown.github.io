<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Projects</title>
<meta name="generator" content="Org Mode" />
<style type='text/css'>
<!--/*--><![CDATA[/*><!--*/
/* nice-org-html.css
;;==============================================================================
;; Copyright (C) 2024, Ewan Townshend

;; Author: Ewan Townshend
;; URL: https://github.com/ewantown/nice-org-html
;; Version: 1.2

;;==============================================================================
;; This program is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.

;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <https://www.gnu.org/licenses/>.

;; This file is not part of emacs.

;;==============================================================================
*/

/* basic layout ***************************************************************/
*,
*::before,
*::after {
    box-sizing: border-box;
}
html {
    font-family: Sans;
    line-height: 1.3;
    font-size: calc(15px + 0.390625vw);
    -webkit-text-size-adjust: 100%;
}

body {
    background: #999; /* overwritten with theme --bg */
    width: 100%;
    min-height: 100vh;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family:
	-apple-system,
	BlinkMacSystemFont,
	segoe ui,
	Roboto,
	Oxygen,
	Ubuntu,
	Cantarell,
	open sans,
	helvetica neue,
	sans-serif,
	system-ui
}

#preamble,
#postamble {
    width: 100%;
}

#content {
    width: 80%;
    max-width: 80ch;
    margin-left: 1rem;
    margin-right: 1rem;
    flex: 1;
}

/* custom facing **************************************************************/
/* The variable values are injected by CSS pre-processing in et-org-html.el */
:root {
    --bc-tb: #b3b9be;
    --bc-block: #da8b55;
    --clr: #655370;
    --clr-tb-hd: #655370;
    --clr-code: #655370;
    --bg: #fbf8ef;
    --bg-code: #e7e5eb;
    --bg-tb-hd: #e7e5eb;
    --bg-block: #e8e3f0;
    --clr-link: #4e3163;
    --clr-title: #655370;
    --clr-todo: #2d9574;
    --bg-todo: initial;
    --clr-done: #2aa1ae;
    --bg-done: #ecf3ec;
    --ts-clr: #3a81c3;
    --mg: 20px;
    --w-toc: 300px;
    --bg-keyword: initial;
    --clr-keyword: #3a81c3;
    --bg-constant: initial;
    --clr-constant: #4e3163;
    --bg-comment: #ecf3ec;
    --clr-comment: #2aa1ae;
    --bg-comment-delimiter: initial;
    --clr-comment-delimiter: initial;
    --bg-function: initial;
    --clr-function: #6c3163;
    --bg-variable: initial;
    --clr-variable: #715ab1;
    --bg-preprocessor: initial;
    --clr-preprocessor: #6c3163;
    --bg-doc: initial;
    --clr-doc: #da8b55;
    --bg-builtin: initial;
    --clr-builtin: #3a81c3;
    --bg-string: initial;
    --clr-string: #2d9574;
    --clr-note: #0969da;
    --clr-tip: #1a7f37;
    --clr-important: #8250df;
    --clr-warning: #9a6700;
    --clr-caution: #cf222e;
}

body[data-mode='light'] {
    background: var(--bg);
    color: var(--clr);
}

body[data-mode='dark'] {
    background: var(--bg);
    color: var(--clr);
    --bc-tb: #5d4d7a;
    --bc-block: #9f8766;
    --clr: #b2b2b2;
    --clr-code: #b2b2b2;
    --clr-tb-hd: #b2b2b2;
    --bg: #292b2e;
    --bg-tb-hd: #222226;
    --bg-code: #222226;
    --bg-block: #2f2b33;
    --clr-link: #a45bad;
    --clr-title: #b2b2b2;
    --clr-todo: #2d9574;
    --bg-todo: initial;
    --clr-done: #2aa1ae;
    --bg-done: #292e34;
    --ts-clr: #4f97d7;
    --mg: 20px;
    --w-toc: 300px;
    --bg-keyword: initial;
    --clr-keyword: #4f97d7;
    --bg-constant: initial;
    --clr-constant: #a45bad;
    --bg-comment: #292e34;
    --clr-comment: #2aa1ae;
    --bg-comment-delimiter: initial;
    --clr-comment-delimiter: initial;
    --bg-function: initial;
    --clr-function: #bc6ec5;
    --bg-variable: initial;
    --clr-variable: #7590db;
    --bg-preprocessor: initial;
    --clr-preprocessor: #bc6ec5;
    --bg-doc: initial;
    --clr-doc: #9f8766;
    --bg-builtin: initial;
    --clr-builtin: #4f97d7;
    --bg-string: initial;
    --clr-string: #2d9574;
    --clr-note: #0969da;
    --clr-tip: #1a7f37;
    --clr-important: #8250df;
    --clr-warning: #9a6700;
    --clr-caution: #cf222e;
}

/* exceptions for badly rendering themes **************************************/
body[data-theme='leuven'],
body[data-theme='leuven-dark'] {
    --bg-code: var(--bg-block);
}

/* ootb page layout ***********************************************************/
#view-controls {
    position: sticky;
    display: flex;
    align-items: center;
    justify-content: center;
    top: 0;
    left: 0;
    width: 100%;
    background: var(--bg);
    color: var(--clr-code);
    height: 2.5rem;
    padding-top: 1.25rem;
    padding-bottom: 1.25rem;
    z-index: 100;
    border-radius: 5px; /* Rounded corners */
}
#toggle-mode {
    position: absolute;
    right: 5%;
    display: block;
    text-align: center;
    font-size: 1.5rem;
    background: var(--bg);
    color: var(--clr-code);
    padding: 0.25rem 0;
}
#goto-top {
    display: none;
}
#goto-top[data-show="true"] {
    position: relative;
    display: block;
    text-align: center;
    font-size: 1rem;
    background: var(--bg);
    color: var(--clr-code);
    padding: 0.25rem 0;
}
#toggle-toc {
    display: none;
}
#toggle-toc[data-show="true"] {
    position: absolute;
    left: 5%;
    display: block;
    text-align: center;
    font-size: 1.5rem;
    background: var(--bg);
    color: var(--clr-code);
    padding: 0.25rem 0;
}

#toggle-toc:hover,
#goto-top:hover,
#toggle-mode:hover {
    cursor: pointer;
}

#table-of-contents {
    display: none;
}
#table-of-contents[data-show="true"] {
    width: 80%;
    max-width: 80rem;
    margin-left: 1rem;
    margin-right: 1rem;
    background: var(--bg);
    scrollbar-width: none;
    -ms-overflow-style: none;
}

#table-of-contents::-webkit-scrollbar {
    display: none;
}

body[data-toc="true"] #content * {
    display: none;
}
body[data-toc="true"] #content #table-of-contents,
body[data-toc="true"] #content #table-of-contents * {
    display: block;
}


/* misc elements **************************************************************/

hr {
    height: 0;
    color: inherit;
}

b,
strong {
    font-weight: bolder;
}

code,
kbd,
samp,
pre {
    font-family:
	Menlo,
	ui-monospace,
	SFMono-Regular,
	Consolas,
	'Liberation Mono',
	monospace;
}

small {
    font-size: 80%;
}

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sub {
    bottom: -0.25em;
}

sup {
    top: -0.5em;
}

table {
    text-indent: 0;
    border-color: inherit;
}

summary {
    display: list-item;
}

h1 {
    color: var(--clr-title);
    text-align: center;
}
h2 {
    margin-top: 2rem;
    margin-bottom: 1rem;
}

code {
    color: var(--clr-code);
    background: var(--bg-code);
    border-radius: 2px;
    padding-left: 5px;
    padding-right: 5px;
}

pre::-webkit-scrollbar {
    display: none;
}

.todo {
    color: var(--clr-todo);
    background: var(--bg-todo);
}

.done {
    color: var(--clr-done);
    background: var(--bg-done);
}

.timestamp-wrapper {
    font-size: 0.8rem;
    color: var(--clr-ts);
}

table {
    width: 100%;
    border: 2px solid var(--bc-tb);
}

thead {
    color: var(--clr-tb-hd);
    background: var(--bg-tb-hd);
}

td, th {
    border: thin solid var(--bc-tb);
}

li {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
}
#text-table-of-contents li a:before {
    content: "• "
}

a {
    text-decoration: none;
    color: var(--clr-link);
}

a:hover {
    text-decoration: underline;
}

.MathJax_Display {
    font-size: 1.25em;
}

img {
    max-width: 100%;
}

pre {
    padding: 1rem;
    border: 1px solid var(--bc-block);
    border-radius: 0.5rem;
    background: var(--bg-block);
    font-size: 0.9rem;
    overflow-x: auto;
    -ms-overflow-style: none;
    scrollbar-width: thin;
}

.org-src-wrapper {
    position: relative;
    border: 1px solid var(--bc-block);
    border-radius: 0.5rem;
    background: var(--bg-code);
}

.org-src-bar {
    position: relative;
    top: 0rem;
    width: 100%;
    background: var(--bg-code);
    border-radius: 0.5rem;
    text-align: right;
    min-height: 1rem;
}

.org-src-wrapper .org-src-container {
    position: relative;
    border: none;
    border-radius: 0.5rem;
    background: var(--bg-code);
    z-index: 0;
}

.org-src-wrapper .org-src-container pre.src {
    border: none !important;
    background: var(--bg-code) !important;
    padding-top: 0rem;
    padding-bottom: 0rem;
    margin-top: 0rem;
    margin-bottom: 0rem;
    padding-bottom: 1.6rem;
}

.org-src-wrapper .org-src-bar .srcLangLabel {
    top: 0rem;
    right: 1.6rem;
    background-color: transparent;
    color: var(--clr-doc);
    border: none;
    padding: 0.5rem;
    padding-bottom: 0.3rem;
    text-align: center;
    text-decoration: none;
    font-size: 0.8rem;
    opacity: 0.5;
    z-index: 1;
    display: none;
}

.org-src-wrapper .org-src-bar .copyBtn {
    top: 0rem;
    right: 0.1rem;
    background-color: transparent;
    color: var(--clr-doc);
    border: none;
    padding: 0.5rem;
    padding-right: 0.7rem;
    padding-bottom: 0.3rem;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 0.8rem;
    cursor: pointer;
    opacity: 0.5;
    z-index: 1;
    transition: opacity 0.3s;
}

.org-src-wrapper .copyBtn:hover {
    opacity: 1;
}

.org-src-wrapper .copyBtn i {
    margin-right: 0.5rem;
    padding: 0.5rem;
}

.admonition {
    margin: 0.2rem;
    color: inherit;
    border-left: .25rem solid;
}
.admonition-title {
    margin: 0 0 0.5rem 0.5rem;
    padding: 0.5rem 0 0 0;
    display: flex;
    align-items: center;
}
.admonition-content > p {
    margin: 0.5rem 0 0 0.5rem;
    padding: 0 0 0.5rem 0;
}

.admonition.note {
    border-left-color: var(--clr-note);
}
.admonition-title.note {
    color: var(--clr-note);
}
.admonition-title.note:before {
    content: '';
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-note);
    mask-size: cover;    
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path class="admonition-icon-note" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>');    
}
.admonition-icon-note {
    fill: var(--clr-note);
}

.admonition.tip {
    border-left-color: var(--clr-tip);
}
.admonition-title.tip {
    color: var(--clr-tip);
}
.admonition-title.tip:before {
    content: '';
    fill: var(--clr-tip);    
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-tip);
    mask-size: cover;
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>');    
}

.admonition.important {
    border-left-color: var(--clr-important);
}
.admonition-title.important {
    color: var(--clr-important);
}
.admonition-title.important:before {
    content: '';
    fill: var(--clr-important);    
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-important);
    mask-size: cover;
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>');    
}

.admonition.warning {
    border-left-color: var(--clr-warning);
}
.admonition-title.warning {
    color: var(--clr-warning);
}
.admonition-title.warning:before {
    content: '';
    color: var(--clr-warning);    
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-warning);
    mask-size: cover;
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>');
}


.admonition.caution {
    border-left-color: var(--clr-caution);
}
.admonition-title.caution {
    color: var(--clr-caution);
}
.admonition-title.caution:before {
    content: '';
    fill: var(--clr-caution);    
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-caution);
    mask-size: cover;
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>');    
}
/* responsive layouts *********************************************************/

@media only screen and (max-width: 768px) {
    #toggle-toc[data-show='true'] {
	padding-right: 5%;
    }
    #toggle-mode {
	padding-left: 5%;
    }
    #content {
	width: 90%;
    }
}

@media only screen and (max-width: 480px) {
    #view-controls {
	padding-top: 1.5em;
	padding-bottom: 1.5em;
    }
    #toggle-toc[data-show='true'] {
	padding-right: 5%;
    }
    #toggle-mode {
	padding-left: 5%;
    }
    #content {
	width: 90%;
    }
}


/* generated header and footer ************************************************/

#generated-header,
#generated-footer {
    width: 90%;
    margin-left: 5%;
    margin-right: 5%;
    line-height: 1;
}
.generated header {
    top: 0;
    left: 0;
}
.generated footer {
    bottom: 0;
    left: 0;
}
.generated header a,
.generated footer a {
    display: inline;
    color: var(--clr-title);
    text-decoration: none;
    transition: color .15s ease-in;
}
.generated header a:hover,
.generated footer a:hover {
    color: var(--clr-link);
}

.generated header nav {
    position: relative;
    margin-top: 1rem;
    top: 0;
    left: 0;
}
.generated footer nav {
    position: relative;
    bottom: 0;
    left: 0;
}

.generated .separator {
    display: block;
    width: 111%;
    margin-left: -5.5%;
    max-width: 100vw;
    height: 0.125rem;
    background: var(--bg-code);
}

.generated a .nav-title,
.generated a .nav-author {
    display: inline;
    margin-top: 1rem;
    margin-bottom: 1rem;
    padding-right: 10rem;
}

.generated .nav-title {
    letter-spacing: .075rem;
    font-weight: 500;
}

.generated .nav-toggle {
    display: none;
}
.generated .nav-button {
    display: none;
}
.generated .nav-list {
    overflow-y: hidden;
    display: block;
    float: right;
    list-style: none;
    margin-bottom: 0;
    margin-top: 0;
}

.generated .nav-item {
    position: relative;
    float: left;
    margin: 0;
}
.generated .nav-link {
    position: relative;
    float: right;
    margin-left: 2rem;
    margin-right: 0rem;
}

.generated .nav-toggle {
    max-height: 0;
    visibility: hidden;
    overflow-y: hidden;
}

.generated header .separator {
    margin-top: 1rem;
    margin-bottom: 0;
}

.generated footer .separator {
    margin-bottom: 1rem;
    margin-top: 0;
}

.generated .menu-sep {
    display: none;
    max-height: 0;
    overflow-y: hidden;
    transition: max-height 0.2s ease;
}

.generated footer {
    padding-bottom: 1rem;
}

.generated.compact footer {
    padding-bottom: 0;
}

.generated.compact header .separator {
    margin-top: 0;
    margin-bottom:0;
}
.generated.compact footer .separator {
    margin-bottom: 1rem;
}

.generated.compact .nav-toggle {
    visibility: visible;
}

.generated.compact .nav-toggle + label span::before {
    transition: all 0.2s ease-in;
}
.generated.compact .nav-toggle:checked + label span::before {
    transform: translateX(0.04rem) translateY(-0.25rem) rotate(90deg);
    transition: all 0.2s ease;
}

.generated.compact .menu-sep {
    display: flex;
    max-height: 0rem;
}
.generated.compact .nav-toggle:checked + label + .menu-sep {
    display: block;
    position: relative;
    max-height: 1rem;
    transition: max-height 0.2s ease;
}

.generated.compact .nav-list {
    float: none !important;
    position: relative;
    display: block;
    padding-left: 0;
    padding-right: 0;
    z-index: 5;
    width: 100%;
    height: auto;
    max-height: 0;
    margin: 0;
    overflow-x: hidden;
    overflow-y: hidden;
    transition: max-height 0.2s ease;
}
.generated.compact .nav-toggle:checked + label ~ .nav-list {
    display: block;
    max-height: 100rem;
    overflow-y: hidden;
}
.generated.compact header .nav-toggle:checked + label ~ .nav-list {
    transition: max-height 0.2s ease;
}

.generated.compact .nav-button {
    display: inline;
    position: relative;
    float: right;
    font-size: 1rem;
}
.generated.compact .nav-button span::before {
    display: inline-block;
    content: '\2807';
    font-size: 2rem;
    transform: translateX(0.25rem) translateY(-0.5rem);
}

.generated.compact .nav-item {
    float: none !important;
    text-align: center !important;
}
.generated.compact .nav-link {
    line-height: 2rem;
    margin-left: 2rem;
    margin-right: 2rem;
    float: none !important;
}

.generated.compact footer .separator.menu-sep {
    margin-bottom: -1rem;
}

.hidden {
    display: none;
}

.collapsible:hover {
    cursor: pointer;
}

.collapsible.collapsed::after {
    display: inline-block;
    content: '...';
}
h6::before { content: '';
margin-right: calc(0 * 0.26em);
}
h5::before { content: '';
margin-right: calc(0 * 0.25em);
}
h4::before { content: '▷';
margin-right: calc(4 * 0.24em);
}
h3::before { content: '';
margin-right: calc(0 * 0.23em);
}
h2::before { content: '';
margin-right: calc(0 * 0.22em);
}
/*]]>*/-->
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="preamble" class="status">
<div id='generated-header' class='generated'><header>
 <nav>
<a class='nav-title'href='home' >
Ewan Townshend
</a>
<input id='nav-toggle-top' class='nav-toggle' type='checkbox'>
<label class='nav-button' for='nav-toggle-top'><span/></label>
<div class='separator menu-sep'></div>
<ul class='nav-list'>
<li class='nav-item'>
<a class='nav-link' href='about'>
About</a>
</li>
<li class='nav-item'>
<a class='nav-link' href='projects'>
Projects</a>
</li>
<li class='nav-item'>
<a class='nav-link' href='thoughts'>
Thoughts</a>
</li>
</ul>
<div class='separator'></div>
</nav>
</header>
</div>
<div id='view-controls'><div id='toggle-mode' title='Mode'>&#9788;</div><div id='goto-top' title='Top'>&#8963;</div><div id='toggle-toc' title='Contents'>&#9776;</div></div>
</div>
<div id="content" class="content">
<h1 class="title">Projects</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org0e5f0b9">nice-org-html</a></li>
<li><a href="#org678d946">M-&lambda;</a></li>
<li><a href="#org1885f40">Guiser</a></li>
<li><a href="#org0f46220">search-factory</a></li>
<li><a href="#org98abe61">LifeInteractive</a></li>
</ul>
</div>
</div>
<div id="outline-container-org0e5f0b9" class="outline-2">
<h2 id="org0e5f0b9"><a href="https://github.com/ewantown/nice-org-html">nice-org-html</a></h2>
<div class="outline-text-2" id="text-org0e5f0b9">
<p>
This is an Emacs package (available on <a href="https://melpa.org/#/nice-org-html">Melpa</a>) that generates pretty static websites from <a href="https://orgmode.org/guide/Markup.html">Org Mode markup</a> files and user-chosen Emacs themes. Emacs has a built-in mechanism for exporting .org files and publishing projects comprised of linked .org files, but this mechanism generates very basic HTML, with an outdated appearance when rendered in the browser. This package addresses that shortcoming, in part by leveraging the variety of open-source themes available for Emacs, and in part by using schematic s-expressions to complete HTML component templates. The package provides an Org Export backend, a publishing function, and a publishing-function-generating macro, which enable users to customize the look-and-feel of generated web pages by just specifying values for parameters. This package is used, together with the built-in <a href="https://www.gnu.org/software/emacs/manual/html_node/org/Publishing.html">publisher</a>, to generate the website you are viewing now. Customization is achieved by a single macro call:
</p>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>EMACS-LISP</span><button class='copyBtn' name=btn_0da3b73d2f8540288faa99423a811ec1>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_0da3b73d2f8540288faa99423a811ec1=document.querySelector('button[name=btn_0da3b73d2f8540288faa99423a811ec1]');
copyBtnbtn_0da3b73d2f8540288faa99423a811ec1.addEventListener('click', function(event) {
let res = copyTextToClipboard(`(nice-org-html-publishing-function\n :theme-alist\n ((dark . spacemacs-dark) (light . spacemacs-light))\n :default-mode dark\n :headline-bullets (:h1 \"\" :h2 \"\" :h3 \"▷\" :h4 \"\" :h5 \"\")\n :header\n ((\"Ewan Townshend\" . \"home\")\n  (\"About\" . \"about\")\n  (\"Projects\" . \"projects\")\n  (\"Thoughts\" . \"thoughts\"))\n :footer\n ((\"© 2025\" . nil)				\n  (\"LinkedIn\" . \"https://www.linkedin.com/in/ewan-townshend\")\n  (\"GitHub\" . \"https://github.com/ewantown\")\n  (\"Resumé\" . \"other/sw-resume.pdf\")\n  (\"Email\" . \"mailto:ewan@etown.dev\")))\n`);copyBtnbtn_0da3b73d2f8540288faa99423a811ec1.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_0da3b73d2f8540288faa99423a811ec1.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">nice-org-html-publishing-function</span>
 <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:theme-alist</span>
 ((dark . spacemacs-dark) (light . spacemacs-light))
 <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:default-mode</span> dark
 <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:headline-bullets</span> (<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:h1</span> <span style="color: var(--clr-string); background-color: var(--bg-string);">""</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:h2</span> <span style="color: var(--clr-string); background-color: var(--bg-string);">""</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:h3</span> <span style="color: var(--clr-string); background-color: var(--bg-string);">"&#9655;"</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:h4</span> <span style="color: var(--clr-string); background-color: var(--bg-string);">""</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:h5</span> <span style="color: var(--clr-string); background-color: var(--bg-string);">""</span>)
 <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:header</span>
 ((<span style="color: var(--clr-string); background-color: var(--bg-string);">"Ewan Townshend"</span> . <span style="color: var(--clr-string); background-color: var(--bg-string);">"home"</span>)
  (<span style="color: var(--clr-string); background-color: var(--bg-string);">"About"</span> . <span style="color: var(--clr-string); background-color: var(--bg-string);">"about"</span>)
  (<span style="color: var(--clr-string); background-color: var(--bg-string);">"Projects"</span> . <span style="color: var(--clr-string); background-color: var(--bg-string);">"projects"</span>)
  (<span style="color: var(--clr-string); background-color: var(--bg-string);">"Thoughts"</span> . <span style="color: var(--clr-string); background-color: var(--bg-string);">"thoughts"</span>))
 <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">:footer</span>
 ((<span style="color: var(--clr-string); background-color: var(--bg-string);">"&#169; 2025"</span> . nil)                              
  (<span style="color: var(--clr-string); background-color: var(--bg-string);">"LinkedIn"</span> . <span style="color: var(--clr-string); background-color: var(--bg-string);">"https://www.linkedin.com/in/ewan-townshend"</span>)
  (<span style="color: var(--clr-string); background-color: var(--bg-string);">"GitHub"</span> . <span style="color: var(--clr-string); background-color: var(--bg-string);">"https://github.com/ewantown"</span>)
  (<span style="color: var(--clr-string); background-color: var(--bg-string);">"Resum&#233;"</span> . <span style="color: var(--clr-string); background-color: var(--bg-string);">"other/sw-resume.pdf"</span>)
  (<span style="color: var(--clr-string); background-color: var(--bg-string);">"Email"</span> . <span style="color: var(--clr-string); background-color: var(--bg-string);">"mailto:ewan@etown.dev"</span>)))
</pre>
</div></div>
</div>
</div>
<div id="outline-container-org678d946" class="outline-2">
<h2 id="org678d946"><a href="https://github.com/ewantown/mlambda">M-&lambda;</a></h2>
<div class="outline-text-2" id="text-org678d946">
<p>
This is a programming language implemented in Racket. Specifically, a reflective untyped lambda calculus with call-by-name semantics and first class continuations, which makes apparent some connections between modal logics, metaprogramming, recursion theory, and continuation handling constructs.
</p>

<p>
The core of the project is a pattern matching interpreter, which makes evaluation order independent of the metalanguage (Racket) by passing and reducing a defunctionalized continuation. The value of the language is theoretical, not practical. It's syntax and semantics are as follows:
</p>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>RACKET</span><button class='copyBtn' name=btn_f08dcb7a773f4b4ea267749557c066db>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_f08dcb7a773f4b4ea267749557c066db=document.querySelector('button[name=btn_f08dcb7a773f4b4ea267749557c066db]');
copyBtnbtn_f08dcb7a773f4b4ea267749557c066db.addEventListener('click', function(event) {
let res = copyTextToClipboard(`<sym>   ≡ x: (symbol? x)       \n<wff> ::= (→ <sym> <wff>)      := abstraction\n        | (<wff> <wff>)        := application\n        | (□ <wff>)            := quotation\n        | (▷ <wff> <wff>)      := quote combination (the \"Kleene\" operator)\n        | (ε <wff>)            := evaluation\n        | (ρ <wff>)            := \"reset\" (continuation delimiter)\n        | (σ <wff>)            := \"shift\" (introduces delimited continuation)\n        | (callcc <wff>)       := \"control\" (introduces global continuation)\n        | (dropcc <wff>)       := \"abort\"   (eliminates global continuation)\n`);copyBtnbtn_f08dcb7a773f4b4ea267749557c066db.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_f08dcb7a773f4b4ea267749557c066db.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-racket">&lt;sym&gt;   ≡ x: (symbol? x)       
&lt;wff&gt; ::= (→ &lt;sym&gt; &lt;wff&gt;)      := abstraction
        | (&lt;wff&gt; &lt;wff&gt;)        := application
        | (□ &lt;wff&gt;)            := quotation
        | (▷ &lt;wff&gt; &lt;wff&gt;)      := quote combination (the "Kleene" operator)
        | (ε &lt;wff&gt;)            := evaluation
        | (ρ &lt;wff&gt;)            := "reset" (continuation delimiter)
        | (σ &lt;wff&gt;)            := "shift" (introduces delimited continuation)
        | (callcc &lt;wff&gt;)       := "control" (introduces global continuation)
        | (dropcc &lt;wff&gt;)       := "abort"   (eliminates global continuation)
</pre>
</div></div>

<p>
The syntax was chosen to reflect an extended Curry-Howard correspondence between modal logic S4 and <i>reflective</i> lamba calculi, with quotation, evaluation, and the Kleene operator giving rise to "code combinators". That correspondence is roughly summarized below:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Code Combinator</th>
<th scope="col" class="org-left">Modal Formula</th>
<th scope="col" class="org-left">Axiom</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>(→ x (→ y (▷ x y)))</code></td>
<td class="org-left">\(□(A → B) → (□A → □B)\)</td>
<td class="org-left"><b>K</b></td>
</tr>

<tr>
<td class="org-left"><code>(→ x (ε x))</code></td>
<td class="org-left">\(□A → A\)</td>
<td class="org-left"><b>T</b></td>
</tr>

<tr>
<td class="org-left"><code>(→ x (□ x))</code></td>
<td class="org-left">\(□A → □□A\)</td>
<td class="org-left"><b>4</b></td>
</tr>
</tbody>
</table>

<p>
Some interesting points arise in considering the language.
</p>

<p>
One is that we can derive an infinite hierarchy of staged Quines, with the base of the hierarchy being:
</p>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>RACKET</span><button class='copyBtn' name=btn_d6490b2f998b45bfb5ac8163097bbadf>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_d6490b2f998b45bfb5ac8163097bbadf=document.querySelector('button[name=btn_d6490b2f998b45bfb5ac8163097bbadf]');
copyBtnbtn_d6490b2f998b45bfb5ac8163097bbadf.addEventListener('click', function(event) {
let res = copyTextToClipboard(`'(□ ((→ x (▷ x (□ x))) (□ (→ x (▷ x (□ x))))))\n`);copyBtnbtn_d6490b2f998b45bfb5ac8163097bbadf.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_d6490b2f998b45bfb5ac8163097bbadf.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-racket">'(□ ((→ x (▷ x (□ x))) (□ (→ x (▷ x (□ x))))))
</pre>
</div></div>

<p>
Another is that we have two possible routes into recursive computations. This can be demonstrated as follows. First, we define basic arithmetic values with a familiar Church encoding:
</p>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>RACKET</span><button class='copyBtn' name=btn_87ee1f5da67c4847a39059fa7f5dc6e2>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_87ee1f5da67c4847a39059fa7f5dc6e2=document.querySelector('button[name=btn_87ee1f5da67c4847a39059fa7f5dc6e2]');
copyBtnbtn_87ee1f5da67c4847a39059fa7f5dc6e2.addEventListener('click', function(event) {
let res = copyTextToClipboard(`(define zero '(→ f (→ x x)))\n(define succ '(→ n (→ f (→ x (f ((n f) x))))))  \n`);copyBtnbtn_87ee1f5da67c4847a39059fa7f5dc6e2.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_87ee1f5da67c4847a39059fa7f5dc6e2.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-racket">(define zero '(→ f (→ x x)))
(define succ '(→ n (→ f (→ x (f ((n f) x))))))  
</pre>
</div></div>

<p>
and a basic branching operator:
</p>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>RACKET</span><button class='copyBtn' name=btn_36b28e2d49bf4a40875819296835a369>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_36b28e2d49bf4a40875819296835a369=document.querySelector('button[name=btn_36b28e2d49bf4a40875819296835a369]');
copyBtnbtn_36b28e2d49bf4a40875819296835a369.addEventListener('click', function(event) {
let res = copyTextToClipboard(`(define iszero '(→ f ((f (→ z (→ x (→ y y)))) (→ x (→ y x)))))\n(define ifzero \`((→ p (→ a (→ b ((p a) b)))) ,iszero))  \n`);copyBtnbtn_36b28e2d49bf4a40875819296835a369.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_36b28e2d49bf4a40875819296835a369.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-racket">(define iszero '(→ f ((f (→ z (→ x (→ y y)))) (→ x (→ y x)))))
(define ifzero `((→ p (→ a (→ b ((p a) b)))) ,iszero))  
</pre>
</div></div>

<p>
Then we can define addition, recursively, by application of the Y combinator to a function over the numerals:
</p>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>RACKET</span><button class='copyBtn' name=btn_ff155119434549ddba587dea929edf3e>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_ff155119434549ddba587dea929edf3e=document.querySelector('button[name=btn_ff155119434549ddba587dea929edf3e]');
copyBtnbtn_ff155119434549ddba587dea929edf3e.addEventListener('click', function(event) {
let res = copyTextToClipboard(`(define Y '(→ f ((→ g (f (g g))) (→ g (f (g g))))))\n(define plus \`(→ f (→ n (→ m (((,ifzero n) m) ((f (,prev n)) (,next m)))))))\n(define add-direct \`(,Y ,plus))\n`);copyBtnbtn_ff155119434549ddba587dea929edf3e.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_ff155119434549ddba587dea929edf3e.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-racket">(define Y '(→ f ((→ g (f (g g))) (→ g (f (g g))))))
(define plus `(→ f (→ n (→ m (((,ifzero n) m) ((f (,prev n)) (,next m)))))))
(define add-direct `(,Y ,plus))
</pre>
</div></div>

<p>
Alternatively, we can define addition by applying a <i>staged</i> fixpoint to the <i>code</i> of a function over <i>expressions</i>:
</p>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>RACKET</span><button class='copyBtn' name=btn_a1c1232e763d45419b95cab501f32bab>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_a1c1232e763d45419b95cab501f32bab=document.querySelector('button[name=btn_a1c1232e763d45419b95cab501f32bab]');
copyBtnbtn_a1c1232e763d45419b95cab501f32bab.addEventListener('click', function(event) {
let res = copyTextToClipboard(`(define sfix '(→ e ((→ x ((ε x) x)) (▷ (□ (→ t (→ y (t (▷ y (□ y)))))) e))))\n(define splus \`(→ e (→ n (→ m (((,ifzero n) m) (((ε e) (,prev n)) (,next m)))))))\n(define add-staged \`(,sfix (□ ,splus)))  \n`);copyBtnbtn_a1c1232e763d45419b95cab501f32bab.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_a1c1232e763d45419b95cab501f32bab.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-racket">(define sfix '(→ e ((→ x ((ε x) x)) (▷ (□ (→ t (→ y (t (▷ y (□ y)))))) e))))
(define splus `(→ e (→ n (→ m (((,ifzero n) m) (((ε e) (,prev n)) (,next m)))))))
(define add-staged `(,sfix (□ ,splus)))  
</pre>
</div></div>

<p>
For some of the theoretical backdrop to this project, see <a href="https://okmij.org/ftp/Computation/Kleene.pdf"><i>Kleene Second Recursion Theorem: A Functional Pearl</i></a> (Anonymous, 2018, in Proceedings of the ACM).
</p>
</div>
</div>
<div id="outline-container-org1885f40" class="outline-2">
<h2 id="org1885f40"><a href="https://github.com/ewantown/guiser">Guiser</a></h2>
<div class="outline-text-2" id="text-org1885f40">
<p>
This is a web application enabling users to design multiple “personas”, and generate and post social media content under the guise of a persona to associated accounts on major social media platforms (LinkedIn, Twitter / X, and Threads). The intent of Guiser was three-fold. On one hand, it is a useful tool for social media marketing, enabling a single marketing professional to masquerade as numerous “organic” content creators. On the other hand, its creation was a prescient commentary on the direction of social media in the wake of programmatically accessible large language models. Finally, as a project, it provided an opportunity to work with technologies that comprise the “backbone” of modern web applications with increasing frequency. In this regard, the application was written in JavaScript and TypeScript, uses the MERN stack, and has four OAuth integrations (Google, LinkedIn, Meta, Twitter/X), five external REST API integrations (LinkedIn, Meta, Twitter/X, MongoDB Atlas), and one internal REST API to handle client-server transactions.
</p>
</div>
</div>
<div id="outline-container-org0f46220" class="outline-2">
<h2 id="org0f46220"><a href="https://github.com/ewantown/search-factory">search-factory</a></h2>
<div class="outline-text-2" id="text-org0f46220">
<p>
This is a Racket library providing very general data structures for defining problems with graphs, and higher-order functions that produce deterministic and stochastic graph search functions to client specifications. The library abstracts away points of variance among graph search procedures, including many outlined in Russell and Norvig's <i>Artificial Intelligence: A Modern Approach</i>, as functions passed as closures to more general parameterized search procedure constructors. Use of the library facillitates fine-grained specification of strategies for solving basic tree and graph search problems, constraint satisfaction problems (including 3SAT, etc.), and optimization problems, all within a unified framework.
</p>
</div>
</div>
<div id="outline-container-org98abe61" class="outline-2">
<h2 id="org98abe61"><a href="https://github.com/ewantown/LifeInteractive">LifeInteractive</a></h2>
<div class="outline-text-2" id="text-org98abe61">
<p>
This is a Java implementation of a novel single-player game based on Conway's zero-player <i>Game of Life</i> (a cellular automaton). The non-existence of this variant on Conway's game was a conceptual itch I wanted to scratch. The idea is that a user interacts with a grid of cells ("lifeform") evolving "naturally" from an initial state in accordance with the rules of Conway's game, by controlling an avatar that moves about the grid firing "bullets" and "seeds". If a bullet collides with a live cell, the user gains a point, and the cell is killed, thus influencing evolution of the lifeform. Firing a seed costs the user a point, but if the seed collides with a live cell, a new cell spawns at the point of collision, thus influencing evolution of the lifeform. As a result of these rules, a user's score is maximized by behaviour that "cultivates" the lifeform, rather than extinguishing it. The choice of Java for implementation was due to the relative ease of developing a platform-independent desktop GUI for interacting with a lifeform. The interactive form of the game, with an '80s arcade aesthetic, turned out to actually be quite fun. But more generally, the intent of the program was to serve as a visualized "sandbox" for tinkering with programmatically controlled gameplaying agents.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id='generated-footer' class='generated'><footer>
 <nav>
<div class='separator'></div>
<span class='nav-author'>
© 2025
</span>
<input id='nav-toggle-bot' class='nav-toggle' type='checkbox'>
<label class='nav-button' for='nav-toggle-bot'><span/></label>
<div class='separator menu-sep'></div>
<ul class='nav-list'>
<li class='nav-item'>
<a class='nav-link' href='https://www.linkedin.com/in/ewan-townshend'>
LinkedIn</a>
</li>
<li class='nav-item'>
<a class='nav-link' href='https://github.com/ewantown'>
GitHub</a>
</li>
<li class='nav-item'>
<a class='nav-link' href='other/sw-resume.pdf'>
Resumé</a>
</li>
<li class='nav-item'>
<a class='nav-link' href='mailto:ewan@etown.dev'>
Email</a>
</li>
</ul>
</nav>
</footer>
</div>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
if (!document.cookie.split('; ').find(r => r.startsWith('mode'))) {
document.cookie = 'mode=dark'
}
document.cookie = 'light=spacemacs-light'
document.cookie = 'dark=spacemacs-dark'
/*
;; nice-org-html.js
;;==============================================================================
;; Copyright (C) 2024, Ewan Townshend

;; Author: Ewan Townshend
;; URL: https://github.com/ewantown/nice-org-html
;; Version: 1.2

;;==============================================================================
;; This program is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.

;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <https://www.gnu.org/licenses/>.

;; This file is not part of emacs.

;;==============================================================================
;; JS for html exported by et-org-html.el
 */

const preamble = document.getElementById("preamble");
const content = document.getElementById("content");
const postamble = document.getElementById("postamble");

const controls = document.getElementById("view-controls");
const toggleTocBtn = document.getElementById("toggle-toc");
const gotoTopBtn = document.getElementById("goto-top");
const toggleModeBtn = document.getElementById("toggle-mode");
const toc = document.getElementById("table-of-contents");

// Get and parse options passed in cookie string
const optCookie = document.cookie.split('; ').find(r => r.startsWith('options'));
const options = {};
if (optCookie) {
  optCookie.split('=')[1].split('__').forEach(pair => {
    const [key, val] = pair.split(':');
    if (key && val) {
      options[key] = val;
    }
  })
}

// Move sticky control bar (injected within preamble)
document.body.insertBefore(controls, content);

// Mode handling
function getMode() {
  let cookie = document.cookie.split('; ').find(r => r.startsWith('mode'))
  return cookie && cookie.split("=")[1];
}

function setMode(mode) {
  document.body.dataset.mode = mode;
  let thmCookie = document.cookie.split('; ').find(r => r.startsWith(mode));
  document.body.dataset.theme = thmCookie ? thmCookie.split('=')[1] : 'unknown';
  toggleModeBtn.innerHTML = (mode === 'light') ? '&#9789;' : '&#9788;';
  document.cookie = 'mode=' + mode;
}

// Initially, set mode based on stored cookie
let mode = getMode();
if (mode && ["light", "dark"].includes(mode)) {
  setMode(mode);
} else {  
  let prop = "prefers-color-scheme";
  let pref = (mode === "query") && window.matchMedia &&
    ["light", "dark"].find(s => window.matchMedia(`(${prop}: ${s})`).matches);
  setMode(pref || "dark"); // fallback: dark
}

// Mode toggling
toggleModeBtn.addEventListener('click', () => {
  setMode(document.body.dataset.mode === 'dark' ? 'light' : 'dark');
})


// Jump to top
let scrollY = document.documentElement.scrollTop;
window.addEventListener('scroll', () => {
  let atTop = document.documentElement.scrollTop <= preamble.offsetHeight;
  gotoTopBtn.dataset.show = !atTop + "";
});
gotoTopBtn.addEventListener('click', () => {
  window.scrollTo({
    top: 0,
    behavior: "smooth"
  });
})

// Table-of-contents toggling
if (toc) {
  toggleTocBtn.dataset.show = 'true';
  toggleTocBtn.addEventListener('click', () => {
    let showingToc = document.body.dataset.toc;
    scrollY = showingToc ? scrollY : document.documentElement.scrollTop;
    if (showingToc) {
      document.body.dataset.toc = '';
      document.documentElement.scrollTop = scrollY;
    } else {
      let tocHeight =
	Math.max(
	  window.innerHeight - controls.offsetHeight,
	  toc.offsetHeight
	);
      const header = document.getElementById("injected-header");
      if (header && (scrollY > header.offsetHeight)) {
	document.documentElement.scrollTop = preamble.offsetHeight;
      }
      toc.style.height = `${tocHeight}px`;
      document.body.dataset.toc = 'true';
    }
    toc.addEventListener('click', () => {
      if (document.body.dataset.toc) {
	document.body.dataset.toc = '';
	document.documentElement.scrollTop = scrollY;
      }
    })
  })
};

// Instrument anchor linking for sticky control bar
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', (e) => {
    e.preventDefault();
    const targetId = e.currentTarget.getAttribute('href');
    const target = document.querySelector(targetId);

    setTimeout(() => {
      const targetPos = target.getBoundingClientRect().top;
      let offset = targetPos + document.documentElement.scrollTop;
      offset -= controls.offsetHeight;
      window.scrollTo({
	top: offset,
	behavior: "smooth"
      });
    }, 0);
  });
});

function copyTextToClipboard(text) {
  // Make invisible textarea
  var textArea = document.createElement("textarea");
  textArea.style.position = 'fixed';
  textArea.style.top = 0;
  textArea.style.left = 0;
  textArea.style.width = '2em';
  textArea.style.height = '2em';
  textArea.style.padding = 0;
  textArea.style.border = 'none';
  textArea.style.outline = 'none';
  textArea.style.boxShadow = 'none';
  textArea.style.background = 'transparent';

  // Copy contents into it
  textArea.value = text;

  // Try to copy from it to clipboard
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  var res;
  try {
    res = document.execCommand('copy');
  } catch (err) {
    res = false;
  }

  // Remove invisible textarea
  document.body.removeChild(textArea);

  return res;
}

// Handle the default header / footer drawers
const header = document.getElementById("generated-header");
const footer = document.getElementById("generated-footer");

if (header) {
  let toggle = header.querySelector("header nav input.nav-toggle");
  if (toggle) { toggle.checked = false; }
}
if (footer) {
  let nav = footer.querySelector("nav");
  let toggle = nav && nav.querySelector(".nav-toggle");
  let navList = nav && nav.querySelector(".nav-list");
  let navElem = navList && [...navList.querySelectorAll(".nav-item")];
  let numLink = navElem && navElem.length;
  if (numLink) {
    toggle.checked = false;
    toggle.addEventListener('change', () => {
      if (toggle.checked) {
	setTimeout(() => window.scrollTo({
	  behavior: 'smooth',
	  top: document.body.scrollHeight	  
	}), 88);
      }
   });
  }
}

function autoCompact() {
  var anchor, links, overlap, trivial;
  const domCompute = (node) => {
    if (node) {
      anchor = node.querySelector('.nav-title, .nav-author');
      links = node.querySelector('.nav-list');
      overlap = links.offsetLeft - 5 <= anchor.offsetLeft + anchor.offsetWidth;	
      trivial = links.offsetLeft === anchor.offsetLeft;
    }
  };
  let mediaMatch = window.matchMedia('(max-width: 768px)').matches;
  [header, footer].forEach(e => {
    if (e) {
      if (mediaMatch) {
	e.classList.add('compact');
      } else {
	domCompute(e);
	if (overlap && !trivial) {
	  e.classList.add('compact');
	} else {	
	  let clone = e.cloneNode(true);
	  clone.style.top = '-2000px';
	  clone.style.maxHeight = '0px';
	  clone.classList.remove('compact');
	  e.parentNode.insertBefore(clone, e);
	  domCompute(clone);
	  let toggle = e.querySelector('.nav-toggle');
	  if (!overlap && toggle && !toggle.checked) {
	    e.classList.remove('compact');
	  }
	  e.parentNode.removeChild(clone);
	}
      }
    }
  })
}

if ((header || footer)) {
  if (options.hasOwnProperty('layout')) {
    [header, footer].forEach(e => e ? e.classList.add(options.layout) : null);
  } else {
    autoCompact();
    window.addEventListener('resize', autoCompact);
  }
}

if (options.hasOwnProperty('src-lang') && options['src-lang'] == 't') {
  let labels = [...document.querySelectorAll('.srcLangLabel')];
  labels.forEach(l => l.style.display = 'inline-block');
}

if (options.hasOwnProperty('collapsing') && options.collapsing == 't') {
  let levels = [2, 3, 4, 5, 6];
  let containerPrefix = 'outline-container-';
  levels.forEach(l => {
    let containers = [...document.querySelectorAll(`.outline-${l}`)];
    containers.forEach(c => {
      let id = c.id.slice(containerPrefix.length);
      let headline = document.getElementById(id);
      let siblings = [...c.children].filter(child => child.id != id);
      headline.classList.add('collapsible');
      headline.addEventListener('click', () => {	
	if (headline.classList.contains('collapsed')) {
	  headline.classList.remove('collapsed');
	  siblings.forEach(child => {
	    child.classList.remove('hidden');
	  });	  
	} else {
	  headline.classList.add('collapsed');
	  siblings.forEach(child => {
	    child.classList.add('hidden');
	  });
	}
      })
    })
  })
}
/*]]>*/-->
</script><div hidden>Generated by: https://github.com/ewantown/nice-org-html</div>
</div>
</body>
</html>
